<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Rabbitmq Native Plugin 3.1.3</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#quickstart"><strong>2</strong><span>Quick Start</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#configuration"><strong>3</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#consuming"><strong>4</strong><span>Consuming Messages</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#publishing"><strong>5</strong><span>Publishing Messages</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#converters"><strong>6</strong><span>Message Converters</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#advanced"><strong>7</strong><span>Advanced Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#upgrading"><strong>8</strong><span>Upgrading</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#changelog"><strong>9</strong><span>Changelog</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p>The native RabbitMQ Grails plugin provides easily consumable messaging functionality.</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Rabbitmq Native Plugin - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Bud Byrd</p>
                            <p><strong>Version:</strong> 3.1.3</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#quickstart"><strong>2</strong><span>Quick Start</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#configuration"><strong>3</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#connection"><strong>3.1</strong><span>Server Connection</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#queuesconf"><strong>3.2</strong><span>Defining Queues</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#exchangesconf"><strong>3.3</strong><span>Defining Exchanges</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#binding"><strong>3.4</strong><span>Binding Queues and Exchanges</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#consuming"><strong>4</strong><span>Consuming Messages</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#handlers"><strong>4.1</strong><span>Message Handlers</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#basic"><strong>4.1.1</strong><span>Basic Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#typed"><strong>4.1.2</strong><span>Typed Message Handlers</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#short"><strong>4.1.3</strong><span>Short-Form Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#messagecontext"><strong>4.1.4</strong><span>MessageContext Object</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#rpc"><strong>4.1.5</strong><span>RPC-Style Messages</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#queues"><strong>4.2</strong><span>Subscribing To Queues</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#exchanges"><strong>4.3</strong><span>Subscribing To Exchanges</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#fanout"><strong>4.3.1</strong><span>Fanout Exchanges</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#topic"><strong>4.3.2</strong><span>Topic Exchanges</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#direct"><strong>4.3.3</strong><span>Direct Exchanges</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#headers"><strong>4.3.4</strong><span>Headers Exchanges</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#consmulti"><strong>4.4</strong><span>Multi-Server</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#centralconf"><strong>4.5</strong><span>Central Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#publishing"><strong>5</strong><span>Publishing Messages</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#send"><strong>5.1</strong><span>Sending Messages</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#rpcsend"><strong>5.2</strong><span>RPC Messages</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#bulk"><strong>5.3</strong><span>Bulk Publishing</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#confirms"><strong>5.4</strong><span>Publisher Confirms</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#converters"><strong>6</strong><span>Message Converters</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#custom"><strong>6.1</strong><span>Custom Message Converters</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#advanced"><strong>7</strong><span>Advanced Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#beans"><strong>7.1</strong><span>Spring Beans</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#rabbitcontext"><strong>7.2</strong><span>Rabbit Context</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#native"><strong>7.2.1</strong><span>Native Objects</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#connection_lifecycle"><strong>7.2.2</strong><span>Starting and Stopping Connections</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#consumer_lifecycle"><strong>7.2.3</strong><span>Starting and Stopping Consumers</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#report"><strong>7.2.4</strong><span>Status Report</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#transactions"><strong>7.3</strong><span>Transactions</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#upgrading"><strong>8</strong><span>Upgrading</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#from_3_0_x"><strong>8.1</strong><span>From 3.0.X</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#from_2_0_x"><strong>8.2</strong><span>From 2.0.X</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#changelog"><strong>9</strong><span>Changelog</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>
The RabbitMQ Native plugin for Grails provides RabbitMQ integration using the Java libraries provided by the RabbitMQ project.
It provides easy configuration of exchanges and queues via a project's configuration, simple configuration of consumers, and
a convenience class to easily publish messages.<p class="paragraph"/>This plugin strives to provide an easy convention to follow to quickly begin consuming messages, but still provide easy
access to the underlying layer to allow users of this plugin to do whatever they need to do outside of those conventions.
It also provides a powerful message body converter system that allows the user to quickly write and plug in converters for
custom data types.<p class="paragraph"/>This guide details the configuration of the plugin, and may not fully explain the use and conventions of the RabbitMQ services
or its Java library.  More information can be found in their <a href="http://www.rabbitmq.com/api-guide.html" target="blank">Java API guide</a> and
<a href="http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.5/rabbitmq-java-client-javadoc-3.1.5" target="blank">JavaDoc</a>.<p class="paragraph"/>


<h1 id="quickstart">2 Quick Start</h1>
This is a quick and dirty how-to detailing how to quickly begin using the plugin. While there is a lot of configurability offered by this plugin, this is a very basic demonstration of its usage.<p class="paragraph"/><h3>Create The Application</h3>
Create a project named <strong class="bold">RabbitExample</strong>. You can do this by entering:
<div class="code"><pre>grails create&#45;app RabbitExample</pre></div><p class="paragraph"/><h3>Add The Plugin</h3>
In <code>grails-app/conf/BuildConfig.groovy</code>, under the <code>plugins</code> section, add:
<div class="code"><pre>plugins &#123;
        // ...<p class="paragraph"/>        compile name: <span class="java&#45;quote">"rabbitmq&#45;<span class="java&#45;keyword">native</span>"</span>, version: <span class="java&#45;quote">"latest.release"</span><p class="paragraph"/>        // &#8230;
    &#125;</pre></div><p class="paragraph"/>Then, refresh the project's dependencies:
<div class="code"><pre>grails refresh&#45;dependencies</pre></div><p class="paragraph"/><h3>Configuring</h3>
In <code>grails-app/conf/Config.groovy</code>, add:
<div class="code"><pre>rabbitmq &#123;
    connection = &#123;
        connection host: <span class="java&#45;quote">"changeme"</span>, username: <span class="java&#45;quote">"changeme"</span>, password: <span class="java&#45;quote">"changeme"</span>
    &#125;
    queues = &#123;
        queue name: <span class="java&#45;quote">"testqueue"</span>
    &#125;
&#125;</pre></div>
<blockquote class="note">
Be sure to replace the appropriate values for your RabbitMQ server and user credentials.
</blockquote><p class="paragraph"/><h3>Consumer</h3>
Create the a consumer by using the following command:
<div class="code"><pre>grails create&#45;consumer com.example.Test</pre></div><p class="paragraph"/>Update the consumer to reflect the following:
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/><span class="java&#45;keyword">import</span> com.budjb.rabbitmq.consumer.MessageContext<p class="paragraph"/>class TestConsumer &#123;
    /&#42;&#42;
     &#42; Consumer configuration.
     &#42;/
    <span class="java&#45;keyword">static</span> rabbitConfig = &#91;
        queue: <span class="java&#45;quote">"testqueue"</span>
    &#93;<p class="paragraph"/>    /&#42;&#42;
     &#42; Handle an incoming RabbitMQ message.
     &#42;
     &#42; @param body    The converted body of the incoming message.
     &#42; @param context Properties of the incoming message.
     &#42; @<span class="java&#45;keyword">return</span>
     &#42;/
    def handleMessage(def body, MessageContext context) &#123;
        println body
        <span class="java&#45;keyword">return</span> <span class="java&#45;quote">"Hello to you, too!"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Controller</h3>
Create a controller by using the following command:
<div class="code"><pre>grails create&#45;controller com.example.Test</pre></div><p class="paragraph"/>Update the controller to reflect the following:
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/><span class="java&#45;keyword">import</span> com.budjb.rabbitmq.publisher.RabbitMessagePublisher<p class="paragraph"/>class TestController &#123;
    RabbitMessagePublisher rabbitMessagePublisher<p class="paragraph"/>    def index() &#123;
        render rabbitMessagePublisher.rpc &#123;
            routingKey = <span class="java&#45;quote">"testqueue"</span>
            body = <span class="java&#45;quote">"Hello!"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Run it!</h4>
Run the grails application.
<div class="code"><pre>grails run&#45;app</pre></div><p class="paragraph"/>You can see the application in action by hitting the test controller. If you're running this on your localhost, your URL may be similar to <code>http://localhost:8080/RabbitExample/test/index</code>.
You should see the message "Hello!" printed the application's output console, and your web browser should dispay the message "Hello to you, too!"



<h1 id="configuration">3 Configuration</h1>
Configuration of the connection to the RabbitMQ server is done in your project's <code>grails-app/conf/Config.groovy</code> file.<p class="paragraph"/>Below is the list of general configuration properties.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Configuration Property</strong></th><th><strong class="bold">Required</strong></th><th><strong class="bold">Description</strong></th><th><strong class="bold">Type</strong></th><th><strong class="bold">Default</strong></th></tr><tr class="table-odd"><td><code>autoStart</code></td><td>&#160;</td><td>If true, will start any consumers during the bootstrap phase of the application startup.</td><td><code>Boolean</code></td><td><code>true</code></td></tr><tr class="table-even"><td><code>enabled</code></td><td>&#160;</td><td>If false, will register the plugin's beans, but prevent the plugin connecting to the RabbitMQ broker(s) and consuming messages.</td><td><code>String</code></td><td><code>true</code></td></tr></table><p class="paragraph"/><blockquote class="note">
If <code>autoStart</code> is set to false, all of the connections to the broker will be initiated, but the message consumers will not
automatically start consuming messages.  To start consuming, use the <code>rabbitContext</code> bean and call <code>rabbitContext.startConsumers()</code>.
</blockquote>



<h2 id="connection">3.1 Server Connection</h2>
The plugin expects the connection configuration to the RabbitMQ server to be defined. A bare minimum configuration example looks like:<p class="paragraph"/><div class="code"><pre>rabbitmq &#123;
    connection = &#123;
        connection host: <span class="java&#45;quote">"example.com"</span>, username: <span class="java&#45;quote">"foo"</span>, password: <span class="java&#45;quote">"bar"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>Connections to many different RabbitMQ servers can be configured.  A multi-server configuration looks like:<p class="paragraph"/><div class="code"><pre>rabbitmq &#123;
    connection = &#123;
        connection host: <span class="java&#45;quote">"rabbit1.example.com"</span>, username: <span class="java&#45;quote">"foo"</span>, password: <span class="java&#45;quote">"bar"</span>
        connection host: <span class="java&#45;quote">"rabbit2.example.com"</span>, username: <span class="java&#45;quote">"foo"</span>, password: <span class="java&#45;quote">"bar"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The following table enumerates all the configuration options available to the connection configuration:
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Configuration Property</strong></th><th><strong class="bold">Required</strong></th><th><strong class="bold">Description</strong></th><th><strong class="bold">Type</strong></th><th><strong class="bold">Default</strong></th></tr><tr class="table-odd"><td><code>host</code></td><td><img border="0" class="center" src="../img//bullet_red.png"></img></td><td>Hostname or IP address of the RabbitMQ server to connect to.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td><code>username</code></td><td><img border="0" class="center" src="../img//bullet_red.png"></img></td><td>Username to log into the RabbitMQ server with.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-odd"><td><code>password</code></td><td><img border="0" class="center" src="../img//bullet_red.png"></img></td><td>Password to log into the RabbitMQ server with.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td><code>name</code></td><td>&#160;</td><td>Name of the connection. This is used while sending messages to a specific RabbitMQ server when using multiple servers.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-odd"><td><code>isDefault</code></td><td>&#160;</td><td>A connection with this set to true will be the server messages are sent to if no specific connection is specified when sending the message.</td><td><code>booleang</code></td><td><code>false</code></td></tr><tr class="table-even"><td><code>port</code></td><td>&#160;</td><td>Port to connect to the RabbitMQ server with.</td><td><code>Integer</code></td><td>5672</td></tr><tr class="table-odd"><td><code>virtualHost</code></td><td>&#160;</td><td>Name of the virtual host to connect to the RabbitMQ server with.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td><code>ssl</code></td><td>&#160;</td><td>Whether to use SSL when connecting to a RabbitMQ server.</td><td><code>boolean</code></td><td><code>false</code></td></tr><tr class="table-odd"><td><code>threads</code></td><td>&#160;</td><td>Threadpool size, if greater than 0, determines how many concurrent messages can be processed at any given time. If set to 0, consumers can consume as many messages as it's configured to.</td><td><code>String</code></td><td><code>0</code></td></tr><tr class="table-even"><td><code>automaticReconnect</code></td><td>&#160;</td><td>If true, will cause the application to automatically reconnect to a server when its connection is dropped.</td><td><code>boolean</code></td><td><code>true</code></td></tr><tr class="table-odd"><td><code>requestedHeartbeat</code></td><td>&#160;</td><td>Heartbeat interval, in seconds. A value of <code>0</code> disables heartbeats.</td><td><code>Integer</code></td><td><code>0</code></td></tr></table>



<h2 id="queuesconf">3.2 Defining Queues</h2>
The plugin allows authors to define the exchanges and queues programatically inside the configuration. This allows the application to configure its own queues without someone
having to manually create the exchanges and queues prior to running the application.<p class="paragraph"/>Queue configuration is also done in the <code>Config.groovy</code> file under the rabbitmq block, much as the server connection is configured. Usage is best illustrated with an example:
<div class="code"><pre>rabbitmq &#123;
    queues = &#123;
        queue name: <span class="java&#45;quote">"example.queue"</span>, durable: <span class="java&#45;keyword">true</span>, exchange: <span class="java&#45;quote">"example.exchange"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The above code will define a queue named <strong class="bold">example.queue</strong>, and its durable flag will be set.<p class="paragraph"/><blockquote class="warning">
Be sure to note that the queues property is a closure. You must ensure that the <strong class="bold"><code>=</code></strong> is present for this feature to function properly.
</blockquote><p class="paragraph"/>If using the multi-server feature of the plugin, it is important to consider what server the queue should be defined in.  The <code>connection</code> property
specifies which server to create the queue in, illustrated below:<p class="paragraph"/><div class="code"><pre>rabbitmq &#123;
    queues = &#123;
        // Assume there is a connection with the name <span class="java&#45;quote">"server1"</span>&#8230;
        queue name: <span class="java&#45;quote">"example.queue"</span>, connection: <span class="java&#45;quote">"server1"</span>, durable: <span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>If there are many queues to be defined for a specific server connection, the connection method provides a convenient way to bunch queue creation.
<div class="code"><pre>rabbitmq &#123;
    queues = &#123;
        // Assume there is a connection with the name <span class="java&#45;quote">"server1"</span>&#8230;
        connection name: <span class="java&#45;quote">"server1"</span>, &#123;
            queue name: <span class="java&#45;quote">"example.queue"</span>, durable: <span class="java&#45;keyword">true</span>
            queue name: <span class="java&#45;quote">"example2.queue"</span>, durable: <span class="java&#45;keyword">true</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>Below is a table of all of the options available when defining queues:
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Required</strong></th><th><strong class="bold">Description</strong></th><th><strong class="bold">Type</strong></th><th><strong class="bold">Default</strong></th></tr><tr class="table-odd"><td><code>arguments</code></td><td>&#160;</td><td>Extra arguments used to create the queue. See the <a href="http://www.rabbitmq.com/documentation.html" target="blank">RabbitMQ documentation</a> for more information.</td><td><code>Map</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td><code>autoDelete</code></td><td>&#160;</td><td>Whether to automatically delete the queue once there are no more consumers listening to it.</td><td><code>boolean</code></td><td><code>false</code></td></tr><tr class="table-odd"><td><code>binding</code></td><td>&#160;</td><td>Used in conjunction with exchanges. See the section below for more information.</td><td> <em class="italic">Mixed</em> </td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td><code>durable</code></td><td>&#160;</td><td>Whether messages should be persisted to the disk on the RabbitMQ server to survive server restarts.</td><td><code>boolean</code></td><td><code>false</code></td></tr><tr class="table-odd"><td><code>exchange</code></td><td>&#160;</td><td>Binds a queue to an exchange in conjunction with the <code>binding</code> property. Ignored if used inside an exchange declaration.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td><code>match</code></td><td>&#160;</td><td>Required when binding to a headers exchange. Either "any" or "all".</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-odd"><td><code>name</code></td><td><img border="0" class="center" src="../img//bullet_red.png"></img></td><td>Name of the queue.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td><code>connection</code></td><td>&#160;</td><td>Name of the connection to create the queue with.  Uses the default connection if omitted.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr></table>



<h2 id="exchangesconf">3.3 Defining Exchanges</h2>
Defining exchanges is very similar to defining queues. The following code illustrates how to define an exchange:
<div class="code"><pre>rabbitmq &#123;
    queues = &#123;
        exchange name: <span class="java&#45;quote">"example.exchange"</span>, type: <span class="java&#45;quote">"topic"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The above example will create an exchange with the name <strong class="bold">example.exchange</strong> and of the type <strong class="bold">topic</strong>. Below is a list of all the options availble when creating exchanges:
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Required</strong></th><th><strong class="bold">Description</strong></th><th><strong class="bold">Type</strong></th><th><strong class="bold">Default</strong></th></tr><tr class="table-odd"><td><code>arguments</code></td><td>&#160;</td><td>Extra arguments used to create the exchange. See the <a href="http://www.rabbitmq.com/documentation.html" target="blank">RabbitMQ documentation</a> for more information.</td><td><code>Map</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td><code>autoDelete</code></td><td>&#160;</td><td>Whether to automatically delete the exchange once there are no longer any queues bound to it.</td><td><code>boolean</code></td><td><code>false</code></td></tr><tr class="table-odd"><td><code>durable</code></td><td>&#160;</td><td>Whether messages should be persisted to the disk on the RabbitMQ server to survive server restarts.</td><td><code>boolean</code></td><td><code>false</code></td></tr><tr class="table-even"><td><code>name</code></td><td><img border="0" class="center" src="../img//bullet_red.png"></img></td><td>Name of the exchange.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-odd"><td><code>type</code></td><td><img border="0" class="center" src="../img//bullet_red.png"></img></td><td>One of "fanout", "topic", "direct", or "headers".</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td><code>connection</code></td><td>&#160;</td><td>Name of the connection to create the exchange with.  Uses the default connection if omitted.</td><td><code>String</code></td><td> <em class="italic">none</em> </td></tr></table><p class="paragraph"/><blockquote class="note">
The same connection considerations exist for exchanges as with queues.  The same <code>connection</code> method works for exchanges as well.
</blockquote>



<h2 id="binding">3.4 Binding Queues and Exchanges</h2>
Queues can be bound to an exchange by setting the <code>exchange</code> property when declaring the queue to the name of the exchange to
bind to. This is the preferred method if the application being configured is not responsible for defining and configuring
the exchange being bound to.<p class="paragraph"/>Queues can also be bound to an exchange by declaring the queues inside of a closure passed as the last parameter of an
exchange definition. This is a convenient method to do queue binding when your application is responsible for defining
and configuring the exchange.
<div class="code"><pre>rabbitmq &#123;
    queues = &#123;
        exchange name: <span class="java&#45;quote">"example.exchange"</span>, type: <span class="java&#45;quote">"topic"</span>, &#123;
            queue name: <span class="java&#45;quote">"example.queue"</span>, binding: <span class="java&#45;quote">"sample.binding.&#35;"</span>
        &#125;
    &#125;
&#125;</pre></div>
This example will create a <strong class="bold">topic</strong> exchange named <strong class="bold">example.exchange</strong>, as well as create a queue named <strong class="bold">example.queue</strong>. The queue will be bound to the exchange with the topic or
routing key of "sample.binding.#".<p class="paragraph"/>Queues need to have their binding defined specifically for the type of exchange they are bound to.<p class="paragraph"/><h3>Fanout Exchanges</h3>
Fanout exchanges are the easiest to configure bindings for, since they require none. Fanout exchanges simply send every message it received to every queue bound to it.
<div class="code"><pre>rabbitmq &#123;
    queues = &#123;
        exchange name: <span class="java&#45;quote">"example.exchange"</span>, type: <span class="java&#45;quote">"fanout"</span>, &#123;
            queue name: <span class="java&#45;quote">"example.queue"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Topic Exchanges</h3>
Topic exchanges require queues to define a topic. Topics can be an exact match, but their strength is in their partial matching ability. See the <a href="http://www.rabbitmq.com/documentation.html" target="blank">RabbitMQ documentation</a>
for details about this kind of exchange.
<div class="code"><pre>rabbitmq &#123;
    queues = &#123;
        exchange name: <span class="java&#45;quote">"example.exchange"</span>, type: <span class="java&#45;quote">"topic"</span>, &#123;
            queue name: <span class="java&#45;quote">"example.queue"</span>, binding: <span class="java&#45;quote">"exmaple.binding.&#35;"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Direct Exchanges</h3>
Direct exchanges are similar to topic exchanges, except that their "topics" only function with direct name matching. The appropriate name for the binding in this case is "routing key". Queues must define a
routing key when binding to this type of exchange.
<div class="code"><pre>rabbitmq &#123;
    queues = &#123;
        exchange name: <span class="java&#45;quote">"example.exchange"</span>, type: <span class="java&#45;quote">"direct"</span>, &#123;
            queue name: <span class="java&#45;quote">"example.queue"</span>, binding: <span class="java&#45;quote">"exmapleRoutingKey"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Header Exchanges</h3>
Header exchanges are like topic exchanges, but with the ability to define multiple match keywords. The binding for queues allows the queue to match on all or one of multiple header values. The queue must also
set the <code>match</code> property for this exchange type, and the value must be one of "any" or "all".
<div class="code"><pre>rabbitmq &#123;
    queues = &#123;
        exchange name: <span class="java&#45;quote">"example.exchange"</span>, type: <span class="java&#45;quote">"headers"</span>, &#123;
            queue name: <span class="java&#45;quote">"example.queue"</span>, match: <span class="java&#45;quote">"any"</span>, binding: &#91;
                <span class="java&#45;quote">"header1"</span>: <span class="java&#45;quote">"header&#45;value&#45;1"</span>,
                <span class="java&#45;quote">"header2"</span>: <span class="java&#45;quote">"header&#45;value&#45;2"</span>
            &#93;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>


<h1 id="consuming">4 Consuming Messages</h1>
Consuming messages is accomplished by creating a message consumer class. Consumer classes are placed into the
<code>grails-app/rabbit-consumers</code>, and must end with <code>Consumer.groovy</code>. These classes are Spring beans, meaning
that they can inject other Spring beans such as services, the <code>grailsApplication</code> instance, etc. Each consumer
class must be configured in a certain way. If there is a misconfiguration in a consumer, the plugin will log
an error stating so and not register the consumer to any queues.



<h2 id="handlers">4.1 Message Handlers</h2>
One of the requirements for a consumer to be registered to the RabbitMQ server is that a message handler be declared
in the consumer class. The message handler is the mechanism by which messages are consumed.



<h2 id="basic">4.1.1 Basic Usage</h2>
In its most basic form, a message handler method takes in the body of the received message, and a <code>MessageContext</code>
object that contains the message parameters received from the RabbitMQ server, along with the consumer's channel
that the handler should publish messages through.<p class="paragraph"/>This is the most generic form of a message handler:
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/><span class="java&#45;keyword">import</span> com.budjb.rabbitmq.consumer.MessageContext<p class="paragraph"/>class ExampleConsumer &#123;
    // ...<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // Do work
    &#125;
&#125;</pre></div>



<h2 id="typed">4.1.2 Typed Message Handlers</h2>
The logic surrounding the message consumer classes will by default attempt to intelligently convert the body of
the received message from a byte array to a converted type, such as a String. Before routing the message to the
consumer and handler, the plugin will run through a list of <a href="../guide/single.html#converters" class="guide">converters</a> that will attempt to convert the message,
and if the conversion was successful, determine if an appropriate handler has been defined.<p class="paragraph"/>For example, consider this JSON blob:
<div class="code"><pre>&#123;<span class="java&#45;quote">"foo"</span>:<span class="java&#45;quote">"bar"</span>,<span class="java&#45;quote">"hi"</span>:<span class="java&#45;quote">"there"</span>&#125;</pre></div><p class="paragraph"/>If the above message is received, the converter for the Map class type will convert the byte array to a Map
of the JSON data. If a valid handler for the Map type is defined, the handler will receive the converted JSON
so that the handler does not need to handle the conversion.<p class="paragraph"/>The following handlers would accept the converted Map:
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/><span class="java&#45;keyword">import</span> com.budjb.rabbitmq.consumer.MessageContext<p class="paragraph"/>class ExampleConsumer &#123;
    // ...<p class="paragraph"/>    def handleMessage(Map body, MessageContext context) &#123;
        // Do work
    &#125;<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // Since def is a <span class="java&#45;keyword">generic</span> type (<span class="java&#45;object">Object</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
If a converter was successfully able to convert the message body, but no handler was defined to handle the
class type, other converters will get a chance to convert the message body. In the above example, if only
a handler for the String type was defined, the handler will receive the JSON blob as a String.<p class="paragraph"/>If no converter is able to convert the message body, the plugin will fall back to passing the handler the raw
byte array received from the RabbitMQ server.
</blockquote>
<blockquote class="warning">
If no handler is defined that can handle the received message (including the raw byte array), an error will
be logged and the message will be rejected.
</blockquote><p class="paragraph"/>The plugin has built-in <a href="../guide/single.html#converters" class="guide">converters</a> for <code>Integer</code>, <code>Map</code>, <code>List</code>, <code>GString</code>, and <code>String</code> types. The plugin allows users
to define their own converters to convert other object types, which will be discussed later in this guide.



<h2 id="short">4.1.3 Short-Form Usage</h2>
In addition to the 2-parameter handler method signature, there are 2 shortcut versions available for use. One form only takes the converted message body, and the other only
takes the <code>MessageContext</code> object. The order of preference when multiple valid handlers are defined is:
<ol>
<li>Long form (body, context)</li>
<li>Short form (body)</li>
<li><code>MessageContext</code> form</li>
</ol><p class="paragraph"/>The short-form handlers are shown below:
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/><span class="java&#45;keyword">import</span> com.budjb.rabbitmq.consumer.MessageContext<p class="paragraph"/>class ExampleConsumer &#123;
    // ...<p class="paragraph"/>    def handleMessage(<span class="java&#45;object">String</span> message) &#123;
        // Do work
    &#125;<p class="paragraph"/>    def handleMessage(MessageContext context) &#123;
        // Do work
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
The <code>MessageContext</code>-only handler will only be called if there is no other handler defined that can possibly handle any conversion of the message body.
</blockquote>



<h2 id="messagecontext">4.1.4 MessageContext Object</h2>
The message context is just an object that encapsulates the data relevant to the received message.  Below
is a list of properties of the class.
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td><code>body</code></td><td>Incoming message in its raw <code>byte</code> format.</td></tr><tr class="table-even"><td><code>channel</code></td><td>The RabbitMQ channel the message handler should use to publish messages. This is especially important when using transactions.</td></tr><tr class="table-odd"><td><code>consumerTag</code></td><td>Consumer tag</td></tr><tr class="table-even"><td><code>envelope</code></td><td>Properties of the message's delivery (see RabbitMQ's <a href="http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.5/rabbitmq-java-client-javadoc-3.1.5/com/rabbitmq/client/Envelope.html" target="blank">documentation</a>)</td></tr><tr class="table-odd"><td><code>properties</code></td><td>Properties of the message (see RabbitMQ's <a href="http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.5/rabbitmq-java-client-javadoc-3.1.5/com/rabbitmq/client/BasicProperties.html" target="blank">documentation</a>)</td></tr></table>



<h2 id="rpc">4.1.5 RPC-Style Messages</h2>
When a client publishes a message and waits for a return reply, this is considered an RPC-style operation. Typically, the server-side of the operation (in this case, a message consumer/handler) must
respond to the client on a queue that the client requested manually. This plugin provides a very convenient method to respond to the client without having to manually construct a response message.<p class="paragraph"/>The client will provide a response queue to the server to reply to. This queue name is stored in the <code>MessageContext.properties.replyTo</code> variable. If a client publishes
this variable, and the handler returns some data, the plugin will convert the data returned from the message handler and build a response message for you.<p class="paragraph"/>The following example illustrates responding via a handler's returned data.<p class="paragraph"/><div class="code"><pre>class RpcExampleConsumer &#123;
    def handleMessage(<span class="java&#45;object">String</span> message, MessageContext messageContext) &#123;
        println <span class="java&#45;quote">"received $&#123;message&#125;"</span><p class="paragraph"/>        <span class="java&#45;keyword">return</span> <span class="java&#45;quote">"response"</span> // <span class="java&#45;keyword">this</span> message will be sent back to the consumer via its replyTo queue
    &#125;
&#125;</pre></div><p class="paragraph"/>Alternatively, the <code>rabbitMessagePublisher</code> can be used to respond.<p class="paragraph"/><div class="code"><pre>class RpcExampleConsumer &#123;
    def rabbitMessagePublisher<p class="paragraph"/>    def handleMessage(<span class="java&#45;object">String</span> message, MessageContext messageContext) &#123;
        println <span class="java&#45;quote">"received $&#123;message&#125;"</span><p class="paragraph"/>        rabbitMessagePublisher.send &#123;
            routingKey: messageContext.properties.replyTo
            body: <span class="java&#45;quote">"response"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
Allowing the plugin to build a reply message only converts the data returned from the message handler and publishes it to the reply queue. If you need to set any of the other message properties,
like headers, content-types, etc, you must manually build the response message using the <code>rabbitMessagePublisher</code>, and refrain from returning data from the message handler.
</blockquote><p class="paragraph"/>


<h2 id="queues">4.2 Subscribing To Queues</h2>
Message consumers can subscribe to either queues or exchanges. When a consumer is registered to a queue, the consumer will receive messages from the queue as
the RabbitMQ server determines that it's the consumer's turn to receive a message, since there may be multiple listeners on the same queue.<p class="paragraph"/>Each message consumer class must have a configuration defined. There are 2 methods to specify the configuration:
<ul class="star">
<li>The consumer class can have a <code>Map</code> assigned to a static variable named <code>rabbitConfig</code>. To subscribe to queues, the only required configuration option is the <code>queue</code> variable, which is the name of the queue to subscribe to.</li>
<li>The application's configuration file can contain the configuration with the path <code>rabbitmq.consumers.&#60;ClassName&#62;</code>.  See the section below for more details.</li>
</ul><p class="paragraph"/>Here is a simple example of a consumer subscribing to a queue.
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/><span class="java&#45;keyword">import</span> com.budjb.rabbitmq.consumer.MessageContext<p class="paragraph"/>class ExampleConsumer &#123;
    <span class="java&#45;keyword">static</span> rabbitConfig = &#91;
        <span class="java&#45;quote">"queue"</span>: <span class="java&#45;quote">"test.queue"</span>
    &#93;<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // <span class="java&#45;object">Process</span> message
    &#125;
&#125;</pre></div><p class="paragraph"/>There are many options available to influence how the consumer works, which can be found in the reference.



<h2 id="exchanges">4.3 Subscribing To Exchanges</h2>
Subscribing to a exchanges is different from subscribing to queues, as there are different types of exchanges with different behavior.
RabbitMQ's libraries do not provide a direct way to subscribe to an exchange, however the plugin provides a way to subscribe to exchanges directly by creating
a temporary queue that is bound to an exchange. The binding requirements differ between the different types of exchanges.<p class="paragraph"/><blockquote class="warning">
Using the functionality to subscribe to an exchange works by creating a temporary queue at runtime that is bound to the exchange and consumed from by
the message consumer.  It is important to note that these queues are randomly named and are exclusive and auto delete, so this feature is not
suitable if messages that are left on this queue should persist if the application shuts down.
</blockquote>



<h2 id="fanout">4.3.1 Fanout Exchanges</h2>
A fanout exchange will forward a received message to every queue bound to it. There is no binding criteria for this kind of exchange.
This is the simplest type of exchange, and is also the easiest to configure.<p class="paragraph"/><h4>Fanout Example</h4>
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/>class ExampleConsumer &#123;
    <span class="java&#45;keyword">static</span> rabbitConfig = &#91;
        <span class="java&#45;quote">"exchange"</span>: <span class="java&#45;quote">"fanout.exchange"</span>
    &#93;<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // <span class="java&#45;object">Process</span> message
    &#125;
&#125;</pre></div>



<h2 id="topic">4.3.2 Topic Exchanges</h2>
A topic exchange will forward messages to queues based on the binding criteria the queue used to register to the exchange. In RabbitMQ terms,
this is called a routing key. The routing key can be either a direct match, or utilize wildcards to do a partial topic match. If a routing key
is omitted, the queue will receive no messages. Use <code>"#"</code> to receive all messages from an exchange.
More information can be found in the RabbitMQ documentation.<p class="paragraph"/><h4>Topic Example</h4>
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/>class ExampleConsumer &#123;
    <span class="java&#45;keyword">static</span> rabbitConfig = &#91;
        <span class="java&#45;quote">"exchange"</span>: <span class="java&#45;quote">"topic.exchange"</span>,
        <span class="java&#45;quote">"binding"</span>: <span class="java&#45;quote">"foo.bar.&#35;"</span>
    &#93;<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // <span class="java&#45;object">Process</span> message
    &#125;
&#125;</pre></div>



<h2 id="direct">4.3.3 Direct Exchanges</h2>
A direct exchange will forward messages to queues based on binding criteria configured similarly to topic exchanges. 
The difference in this case is that direct routing does not utilize wildcards in their routing keys.<p class="paragraph"/><h4>Direct Example</h4>
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/>class ExampleConsumer &#123;
    <span class="java&#45;keyword">static</span> rabbitConfig = &#91;
        <span class="java&#45;quote">"exchange"</span>: <span class="java&#45;quote">"direct.exchange"</span>,
        <span class="java&#45;quote">"binding"</span>: <span class="java&#45;quote">"example"</span>
    &#93;<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // <span class="java&#45;object">Process</span> message
    &#125;
&#125;</pre></div>



<h2 id="headers">4.3.4 Headers Exchanges</h2>
Header exchanges work similarly to topic exchanges. A headers exchange will forward messages to queues based on header values contained
in messages. Additionally, a queue can be bound on multiple header values, along with an option to require one or all of the headers
to match.<p class="paragraph"/><h4>Headers Example</h4>
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/>class ExampleConsumer &#123;
    <span class="java&#45;keyword">static</span> rabbitConfig = &#91;
        <span class="java&#45;quote">"exchange"</span>: <span class="java&#45;quote">"headers.exchange"</span>,
        <span class="java&#45;quote">"binding"</span>: &#91;
            <span class="java&#45;quote">"foo"</span>: <span class="java&#45;quote">"bar"</span>,
            <span class="java&#45;quote">"hi"</span>: <span class="java&#45;quote">"there"</span>
        &#93;,
        <span class="java&#45;quote">"match"</span>: <span class="java&#45;quote">"any"</span>
    &#93;<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // <span class="java&#45;object">Process</span> message
    &#125;
&#125;</pre></div>



<h2 id="consmulti">4.4 Multi-Server</h2>
When using a multi-server setup, it is important to consider what server a consumer should listen on.  Use the <code>connection</code> property in the <code>rabbitConfig</code>
to specify which server the consumer should be bound to.  If the <code>connection</code> is omitted, the consumer will be bound to the default connection.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/>class ExampleConsumer &#123;
    <span class="java&#45;keyword">static</span> rabbitConfig = &#91;
        <span class="java&#45;quote">"queue"</span>: <span class="java&#45;quote">"test.queue"</span>,
        <span class="java&#45;quote">"connection"</span>: <span class="java&#45;quote">"server1"</span> // Where <span class="java&#45;quote">"server1"</span> is a connection configured with that name.
    &#93;<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // Do work
    &#125;
&#125;</pre></div>



<h2 id="centralconf">4.5 Central Configuration</h2>
It is also possible to define the consumer's configuration outside of the consumer in the Grails <code>Config.groovy</code> file.  All of the configuration
options described above are valid for this type of configuration.  This functionality is valuable when a consumer's configuration needs to
be determined at runtime, instead of being hardcoded in the consumer class itself.<p class="paragraph"/>To configuration a consumer in the Grails application's configuration file, an entry matching the consumer's class name should be present
under the <code>rabbitmq.consumers</code> key, as follows:<p class="paragraph"/><div class="code"><pre>// &#8230;
rabbitmq &#123;
    consumers &#123;
        ExampleConsumer &#123;
            queue = <span class="java&#45;quote">"test.queue"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>


<h1 id="publishing">5 Publishing Messages</h1>
Publishing messages through the plugin is achieved by using the <code>rabbitMessagePublisher</code> bean. This Spring bean utilizes a closure-based configuration method to
both send messages without waiting for a response, and sending rpc-style messages. There are many options available to the <code>rabbitMessagePublisher</code> which are
documented in the reference, but this guide will only demonstrate basic usage.<p class="paragraph"/><blockquote class="note">
In a multi-server setup, it is important to consider what server to send a message to. Like configuration and consumers, the <code>connection</code> property
is used to route the message to the proper server connection.
</blockquote>



<h2 id="send">5.1 Sending Messages</h2>
Sending a message means publishing a message to an exchange or queue and not waiting for a response (fire and forget). The only required parameters to the publisher 
are a queue or exchange to publish the message to, and the body of the message.<p class="paragraph"/><h4>Send Example</h4>
<div class="code"><pre><span class="java&#45;keyword">import</span> com.budjb.rabbitmq.publisher.RabbitMessagePublisher<p class="paragraph"/>class ExampleService &#123;
    RabbitMessagePublisher rabbitMessagePublisher<p class="paragraph"/>    def sendSomeMessage() &#123;
        rabbitMessagePublisher.send &#123;
            exchange = <span class="java&#45;quote">"some.exchange"</span>
            routingKey = <span class="java&#45;quote">"some.routingKey"</span>
            body = <span class="java&#45;quote">"hi!"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>RabbitMQ expects the body of a message to be a byte array. Message converters will also work when publishing messages, so if an object type other than <code>byte</code> is
encountered, a suitable message converter will be found and run against the message body, if one exists.



<h2 id="rpcsend">5.2 RPC Messages</h2>
Publishing an RPC message is as easy as sending messages, except the returned message is returned from the function.<p class="paragraph"/><h4>RPC Example</h4>
<div class="code"><pre><span class="java&#45;keyword">import</span> com.budjb.rabbitmq.publisher.RabbitMessagePublisher<p class="paragraph"/>class ExampleService &#123;
    RabbitMessagePublisher rabbitMessagePublisher<p class="paragraph"/>    def sendSomeMessage() &#123;
        def result = rabbitMessagePublisher.rpc &#123;
            exchange = <span class="java&#45;quote">"some.exchange"</span>
            routingKey = <span class="java&#45;quote">"some.routingKey"</span>
            body = <span class="java&#45;quote">"hi!"</span>
            timeout = 5000
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="warning">
The <a href="../ref/Rabbit Message Publisher/timeout.html" class="Rabbit Message Publisher">timeout</a> option is especially important for RPC-style messages. The timeout property is the amount of time (in milliseconds)
the client will wait for the server to respond. If the timeout is reached, a <code>TimeoutException</code> will be thrown. If the timeout is set to 0, the client
will wait indefinitely for a response. The default value of the timeout, if not passed, is 5 seconds.
</blockquote><p class="paragraph"/><blockquote class="note">
More options for the <code>RabbitMessagePublisher</code> can be found in the <strong class="bold">Quick Reference</strong>.
</blockquote>



<h2 id="bulk">5.3 Bulk Publishing</h2>
By default, the publisher opens a new channel for each message it publishes. This is acceptable when sending
individual messages, but when bulk publishing is required, it is much more efficient to open a single channel
and use it for batches of messages.<p class="paragraph"/><blockquote class="note">
As an example, during testing it took about 65 milliseconds to send one message.  If 1000 messages are sent,
the total time to publish is about 65 seconds! Using a single channel for the same operation takes about
1 millisecond per message, cutting the time down to 1 second for all 1000 messages.<p class="paragraph"/>These times are just an example based on testing, but they will differ based on network latency and server load.
</blockquote><p class="paragraph"/>While a channel may be manually created by authors using the <code>rabbitContext</code>, the publisher provides an easy way
to send many messages with a single channel.  See the example below.<p class="paragraph"/><div class="code"><pre>rabbitMessagePublisher.withChannel &#123; channel &#45;&#62;
    1000.times &#123; i &#45;&#62;
        send &#123;
            routingKey = <span class="java&#45;quote">"foobar"</span>
            body = <span class="java&#45;quote">"Bulk message $i"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>There is also a <code>withChannel</code> method that takes in a connection name for multi-server setups.<p class="paragraph"/><div class="code"><pre>rabbitMessagePublisher.withChannel(<span class="java&#45;quote">"connection1"</span>) &#123; channel &#45;&#62;
    1000.times &#123; i &#45;&#62;
        send &#123;
            routingKey = <span class="java&#45;quote">"foobar"</span>
            body = <span class="java&#45;quote">"Bulk message $i on connection1"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>All of the <code>send</code> and <code>rpc</code> methods available with the publisher can be used with <code>withChannel</code>.


<h2 id="confirms">5.4 Publisher Confirms</h2>
The publisher allows authors to enable publisher confirms for a batch of messages using a similar mechanism as
<code>withChannel</code>.  These methods use RabbitMQ's <code>waitForConfirms</code> and <code>waitForConfirmsOrDie</code> methods.  See
RabbitMQ's documentation for more information about how publisher confirms work.<p class="paragraph"/>The reference details all of the various methods that the publisher contains to support confirms, but
below are a couple of basic examples.<p class="paragraph"/>The <code>withConfirms</code> methods utilize the <code>waitForConfirms</code> methods from the RabbitMQ Java library.  <code>withConfirms</code> will
block until all messages sent in the provided closure have been acked or n'acked by the server.  If a timeout
is specified, it will only wait for the amount of time specified before throwing a <code>TimeoutException</code>.<p class="paragraph"/><div class="code"><pre>rabbitMessagePublisher.withConfirms &#123; channel &#45;&#62;
    send &#123;
        routingKey = <span class="java&#45;quote">"foobar"</span>
        body = <span class="java&#45;quote">"I am a test message"</span>
    &#125;<p class="paragraph"/>    send &#123;
        routingKey = <span class="java&#45;quote">"barbaz"</span>
        body = <span class="java&#45;quote">"I am also a test message"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The <code>withConfirmsOrDie</code> methods utilize the <code>waitForConfirmsOrDie</code> methods from the RabbitMQ Java library.
<code>withConfirmsOrDie</code> will block until all messages sent in the provided closure have been acked or n'acked by the
server.  The difference with this method is that if any n'ack is received, an exception is thrown.
As with <code>withConfirms</code>, a timeout can be used.<p class="paragraph"/><div class="code"><pre>rabbitMessagePublisher.withConfirmsOrDie &#123; channel &#45;&#62;
    send &#123;
        routingKey = <span class="java&#45;quote">"foobar"</span>
        body = <span class="java&#45;quote">"I am a test message"</span>
    &#125;<p class="paragraph"/>    send &#123;
        routingKey = <span class="java&#45;quote">"barbaz"</span>
        body = <span class="java&#45;quote">"I am also a test message"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>There are versions of both of these types of methods that take a connection name and/or a timeout.


<h1 id="converters">6 Message Converters</h1>
Message converters are classes that are responsible for converting objects to and from byte arrays. The plugin provides 4 built-in converters that cover basic types:
<ul class="star">
<li><code>Integer</code></li>
<li><code>Map</code></li>
<li><code>List</code></li>
<li><code>GString</code></li>
<li><code>String</code></li>
</ul><p class="paragraph"/>These converters allow message handlers to consume and return data without having to convert that data themselves. They are also used with the <code>RabbitMessagePublisher</code> class.



<h2 id="custom">6.1 Custom Message Converters</h2>
The plugin provides a way for authors to create their own message converters. A custom message converter must be placed in the <code>grails-app/rabbit-converters</code> path, and must end with <code>Converter.groovy</code>.<p class="paragraph"/>Message converters should extend the <code>MessageConverter</code> abstract class. <code>MessageConverter</code> is a generic class, meaning when extending it, you need to pass it the object class type the message
converter will be responsible for converting.<p class="paragraph"/>A message converter can notify the plugin just what abilities it has. Specifically, there are methods that return whether it can convert an object to or from a byte array. A message converter need
not provide two-way conversion.<p class="paragraph"/>Message converters may also provide the plugin with a MIME-type that is typically indicative of the object type it is responsible for. It does not make sense for all object types to have a MIME-type
associated with it, but this is useful to give the plugin hints if the conversion mode is set to attempt conversion only based on the content-type property a message contains.<p class="paragraph"/>Below is an example converter for the String object type. Custom converters should follow the same format.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> com.budjb.rabbitmq.converter.MessageConverter<p class="paragraph"/>class StringMessageConverter <span class="java&#45;keyword">extends</span> MessageConverter&#60;<span class="java&#45;object">String</span>&#62; &#123;
    /&#42;&#42;
     &#42; Returns whether the message converter can convert a value from a <span class="java&#45;object">String</span> to a <span class="java&#45;object">byte</span> array.
     &#42;
     &#42; @<span class="java&#45;keyword">return</span> <span class="java&#45;object">boolean</span>
     &#42;/
    @Override
    <span class="java&#45;keyword">public</span> <span class="java&#45;object">boolean</span> canConvertFrom() &#123;
        <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">true</span>
    &#125;<p class="paragraph"/>    /&#42;&#42;
     &#42; Returns whether the message converter can convert a value from a <span class="java&#45;object">byte</span> array to a <span class="java&#45;object">String</span>.
     &#42;
     &#42; @<span class="java&#45;keyword">return</span> <span class="java&#45;object">boolean</span>
     &#42;/
    @Override
    <span class="java&#45;keyword">public</span> <span class="java&#45;object">boolean</span> canConvertTo() &#123;
        <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">true</span>
    &#125;<p class="paragraph"/>    /&#42;&#42;
     &#42; Converts a value from a <span class="java&#45;object">byte</span> array to a <span class="java&#45;object">String</span>.
     &#42;
     &#42; @param input Value to convert.
     &#42; @<span class="java&#45;keyword">return</span> Value converted to a <span class="java&#45;object">String</span>, or <span class="java&#45;keyword">null</span> <span class="java&#45;keyword">if</span> the conversion failed.
     &#42;/
    @Override
    <span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> convertTo(<span class="java&#45;object">byte</span>&#91;&#93; input) &#123;
        <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">new</span> <span class="java&#45;object">String</span>(input)
    &#125;<p class="paragraph"/>    /&#42;&#42;
     &#42; Converts a value from a <span class="java&#45;object">String</span> to a <span class="java&#45;object">byte</span> array.
     &#42;
     &#42; @param input Value to convert.
     &#42; @<span class="java&#45;keyword">return</span> Value converted to a <span class="java&#45;object">byte</span> array, or <span class="java&#45;keyword">null</span> <span class="java&#45;keyword">if</span> the conversion failed..
     &#42;/
    @Override
    <span class="java&#45;keyword">public</span> <span class="java&#45;object">byte</span>&#91;&#93; convertFrom(<span class="java&#45;object">String</span> input) &#123;
        <span class="java&#45;keyword">return</span> input.getBytes()
    &#125;<p class="paragraph"/>    /&#42;&#42;
     &#42; The MIME&#45;type typically associated with the object type, <span class="java&#45;keyword">if</span> one exists.
     &#42;
     &#42; @<span class="java&#45;keyword">return</span> MIME&#45;type typically associated with <span class="java&#45;keyword">this</span> object type, or <span class="java&#45;keyword">null</span> <span class="java&#45;keyword">if</span> one does not exist.
     &#42;/
    @Override
    <span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> getContentType() &#123;
        <span class="java&#45;keyword">return</span> 'text/plain'
    &#125;<p class="paragraph"/>&#125;</pre></div>



<h1 id="advanced">7 Advanced Usage</h1>
While the plugin effectively wraps the functionality of the RabbitMQ library, the end user has direct access to all of the underlying library objects and connection instances.



<h2 id="beans">7.1 Spring Beans</h2>
The are several beans defined by the plugin to perform its various operations.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Bean Name</strong></th><th><strong class="bold">Purpose</strong></th></tr><tr class="table-odd"><td><code>rabbitContext</code></td><td>A front-end class to the plugin that aggregates useful functionality for users of the&#10;                              plugin.  Besides the <code>rabbitMessagePublisher</code>, this is likely the only bean users will&#10;                              need to access, if at all.</td></tr><tr class="table-even"><td><code>connectionManager</code></td><td>Manages the lifecycle of connection instances, including loading, starting, stopping,&#10;                              unloading, and retrieval.</td></tr><tr class="table-odd"><td><code>messageConverterManager</code></td><td>Handles loading message converters and acts as the entry point when message conversion&#10;                              is required.</td></tr><tr class="table-even"><td><code>consumerManager</code></td><td>Manages the lifecycle of consumer instances, including loading, starting, stopping,&#10;                              unloading, and retrieval.</td></tr><tr class="table-odd"><td><code>queueBuilder</code></td><td>Responsible for creating exchanges and queues defined in the application's configuration.</td></tr><tr class="table-even"><td><code>rabbitMessagePublisher</code></td><td>Used to send messages to a RabbitMQ broker.</td></tr></table>



<h2 id="rabbitcontext">7.2 Rabbit Context</h2>
Besides the <code>rabbitMessagePublisher</code>, the <code>rabbitContext</code> is the bean users will most likely interact with.
While you may never need to use this bean, it can be useful.  As with any Spring bean, the <code>rabbitContext</code> can be
injected into any Spring managed bean, such as services, controllers, and rabbit consumers.<p class="paragraph"/>The <code>rabbitContext</code> is intended to be used as a front-end to all of the other beans defined by the plugin to hide
some of the complexity of interacting with the system. As such, in most cases the <code>rabbitContext</code> proxies requests
to the appropriate manager bean to accomplish the requested task.<p class="paragraph"/><blockquote class="warning">
In some cases, interactions with multiple managers are necessary to safely carry out the action. Therefore, unless
the <code>rabbitContext</code> does not provide the required functionality, it should be considered best-practice to use
the <code>rabbitContext</code> instead of the other beans directly.  If you find that you are frequently resorting to using
one of the other beans, I encourage you to post an issue on the GitHub project.
</blockquote><p class="paragraph"/>The follow subsections describe some of the more useful functionality the <code>rabbitContext</code> provides.


<h2 id="native">7.2.1 Native Objects</h2>
The main goal of the plugin is to effectively wrap the RabbitMQ library to hide the complexity of its usage and
make using it more inline with the conventions of Grails applications, but also allow users to gain access to the
underlying RabbitMQ objects if needed.  <code>rabbitContext</code> provides several methods to gain direct access to the
RabbitMQ Java library <code>Connection</code> and <code>Channel</code> objects.<p class="paragraph"/>To create a new <code>Channel</code>, use the <code>createChannel</code> methods.<p class="paragraph"/><div class="code"><pre>// This creates a <span class="java&#45;keyword">new</span> channel with the <span class="java&#45;keyword">default</span> connection
Channel channel = rabbitContext.createChannel()<p class="paragraph"/>// The same using a different connection based on its name
Channel channel = rabbitContext.createChannel(<span class="java&#45;quote">"connection1"</span>)</pre></div><p class="paragraph"/><blockquote class="warning">
If the <code>createChannel</code> methods are used, it is important that these channels are closed. The plugin handles opening
and closing channels that it manages as part of publishing or consuming messages, but channels created with the
<code>createChannel</code> methods are not managed by the plugin.  It is the author's responsibility to close them, or connection
leaks may and memory leaks most likely will occur.
</blockquote><p class="paragraph"/>Use the <code>getConnection</code> methods to gain access to the <code>Connection</code> objects.<p class="paragraph"/><div class="code"><pre>// To retrieve the Connection from the <span class="java&#45;keyword">default</span> connection
Connection connection = rabbitContext.getConnection()<p class="paragraph"/>// To retrieve the Connection from a specific connection based on its name
Connection connection = rabbitContext.getConnection(<span class="java&#45;quote">"connection1"</span>)</pre></div>


<h2 id="connection_lifecycle">7.2.2 Starting and Stopping Connections</h2>
The plugin handles starting and stopping connections automatically when the application is started or shut down, but
sometimes applications may need to manually stop connections based on certain conditions or business logic. The
<code>rabbitContext</code> contains several methods to manage the life cycle of connections.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Method</th><th>Description</th></tr><tr class="table-odd"><td><code>startConnections</code></td><td>Starts all registered connections.  If some connections are already started, the remainder&#10;                      will also be started.</td></tr><tr class="table-even"><td><code>stopConnections</code></td><td>Stops all connections and all consumers.</td></tr><tr class="table-odd"><td><code>startConnection</code></td><td>Starts a connection based on its name.</td></tr><tr class="table-even"><td><code>stopConnection</code></td><td>Stops a connection based on its name, and stops any consumers on the connection.</td></tr></table>


<h2 id="consumer_lifecycle">7.2.3 Starting and Stopping Consumers</h2>
Much like connections, the <code>rabbitContext</code> provides several methods to start and stop consumers if necessary.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Method</th><th>Description</th></tr><tr class="table-odd"><td><code>startConsumers</code></td><td>Starts all registered consumers.  If some consumers are already started, the remainder&#10;                              will also be started.</td></tr><tr class="table-even"><td><code>stopConsumers</code></td><td>Stops all consumers.</td></tr><tr class="table-odd"><td><code>startConsumer</code></td><td>Starts a connection based on its class name.</td></tr><tr class="table-even"><td><code>stopConsumer</code></td><td>Stops a connection based on its class name.</td></tr><tr class="table-odd"><td><code>startConsumers(String)</code></td><td>Starts all consumers on a specific connection, based on the connection name.</td></tr><tr class="table-even"><td><code>stopConsumers(String)</code></td><td>Stops all consumers on a specific connection, based on the connection name.</td></tr></table>


<h2 id="report">7.2.4 Status Report</h2>
The <code>RabbitContext</code> contains a method <code>getStatusReport()</code>, which will build an object structure
containing information about all RabbitMQ connections and all consumers. This information is useful
to monitor the status of the RabbitMQ application system, as it contains running states and statistics including
how many concurrent threads a consumer is configured for, how many are actually active, and how many are actively
processing messages.  Below is an example of its output gathered from one of the plugin's tests, serialized as JSON.<p class="paragraph"/><div class="code"><pre>&#91;
    &#123;
        <span class="java&#45;quote">"consumers"</span>: &#91;
            &#123;
                <span class="java&#45;quote">"fullName"</span>: <span class="java&#45;quote">"com.budjb.rabbitmq.test.AllTopicConsumer"</span>,
                <span class="java&#45;quote">"load"</span>: 0,
                <span class="java&#45;quote">"name"</span>: <span class="java&#45;quote">"AllTopicConsumer"</span>,
                <span class="java&#45;quote">"numConfigured"</span>: 1,
                <span class="java&#45;quote">"numConsuming"</span>: 1,
                <span class="java&#45;quote">"numProcessing"</span>: 0,
                <span class="java&#45;quote">"queue"</span>: <span class="java&#45;quote">"topic&#45;queue&#45;all"</span>,
                <span class="java&#45;quote">"runningState"</span>: <span class="java&#45;quote">"RUNNING"</span>
            &#125;,
            &#123;
                <span class="java&#45;quote">"fullName"</span>: <span class="java&#45;quote">"com.budjb.rabbitmq.test.ReportingConsumer"</span>,
                <span class="java&#45;quote">"load"</span>: 0,
                <span class="java&#45;quote">"name"</span>: <span class="java&#45;quote">"ReportingConsumer"</span>,
                <span class="java&#45;quote">"numConfigured"</span>: 1,
                <span class="java&#45;quote">"numConsuming"</span>: 1,
                <span class="java&#45;quote">"numProcessing"</span>: 0,
                <span class="java&#45;quote">"queue"</span>: <span class="java&#45;quote">"reporting"</span>,
                <span class="java&#45;quote">"runningState"</span>: <span class="java&#45;quote">"RUNNING"</span>
            &#125;,
            &#123;
                <span class="java&#45;quote">"fullName"</span>: <span class="java&#45;quote">"com.budjb.rabbitmq.test.SleepingConsumer"</span>,
                <span class="java&#45;quote">"load"</span>: 0,
                <span class="java&#45;quote">"name"</span>: <span class="java&#45;quote">"SleepingConsumer"</span>,
                <span class="java&#45;quote">"numConfigured"</span>: 1,
                <span class="java&#45;quote">"numConsuming"</span>: 1,
                <span class="java&#45;quote">"numProcessing"</span>: 0,
                <span class="java&#45;quote">"queue"</span>: <span class="java&#45;quote">"sleeping"</span>,
                <span class="java&#45;quote">"runningState"</span>: <span class="java&#45;quote">"RUNNING"</span>
            &#125;,
            &#123;
                <span class="java&#45;quote">"fullName"</span>: <span class="java&#45;quote">"com.budjb.rabbitmq.test.SpecificTopicConsumer"</span>,
                <span class="java&#45;quote">"load"</span>: 0,
                <span class="java&#45;quote">"name"</span>: <span class="java&#45;quote">"SpecificTopicConsumer"</span>,
                <span class="java&#45;quote">"numConfigured"</span>: 1,
                <span class="java&#45;quote">"numConsuming"</span>: 1,
                <span class="java&#45;quote">"numProcessing"</span>: 0,
                <span class="java&#45;quote">"queue"</span>: <span class="java&#45;quote">"topic&#45;queue&#45;specific"</span>,
                <span class="java&#45;quote">"runningState"</span>: <span class="java&#45;quote">"RUNNING"</span>
            &#125;,
            &#123;
                <span class="java&#45;quote">"fullName"</span>: <span class="java&#45;quote">"com.budjb.rabbitmq.test.StringConsumer"</span>,
                <span class="java&#45;quote">"load"</span>: 0,
                <span class="java&#45;quote">"name"</span>: <span class="java&#45;quote">"StringConsumer"</span>,
                <span class="java&#45;quote">"numConfigured"</span>: 1,
                <span class="java&#45;quote">"numConsuming"</span>: 1,
                <span class="java&#45;quote">"numProcessing"</span>: 0,
                <span class="java&#45;quote">"queue"</span>: <span class="java&#45;quote">"string&#45;test"</span>,
                <span class="java&#45;quote">"runningState"</span>: <span class="java&#45;quote">"RUNNING"</span>
            &#125;,
            &#123;
                <span class="java&#45;quote">"fullName"</span>: <span class="java&#45;quote">"com.budjb.rabbitmq.test.SubsetTopicConsumer"</span>,
                <span class="java&#45;quote">"load"</span>: 0,
                <span class="java&#45;quote">"name"</span>: <span class="java&#45;quote">"SubsetTopicConsumer"</span>,
                <span class="java&#45;quote">"numConfigured"</span>: 1,
                <span class="java&#45;quote">"numConsuming"</span>: 1,
                <span class="java&#45;quote">"numProcessing"</span>: 0,
                <span class="java&#45;quote">"queue"</span>: <span class="java&#45;quote">"topic&#45;queue&#45;subset"</span>,
                <span class="java&#45;quote">"runningState"</span>: <span class="java&#45;quote">"RUNNING"</span>
            &#125;
        &#93;,
        <span class="java&#45;quote">"host"</span>: <span class="java&#45;quote">"localhost"</span>,
        <span class="java&#45;quote">"name"</span>: <span class="java&#45;quote">"connection1"</span>,
        <span class="java&#45;quote">"port"</span>: 5672,
        <span class="java&#45;quote">"runningState"</span>: <span class="java&#45;quote">"RUNNING"</span>,
        <span class="java&#45;quote">"virtualHost"</span>: <span class="java&#45;quote">"test1.rabbitmq.budjb.com"</span>
    &#125;,
    &#123;
        <span class="java&#45;quote">"consumers"</span>: &#91;
            &#123;
                <span class="java&#45;quote">"fullName"</span>: <span class="java&#45;quote">"com.budjb.rabbitmq.test.Connection2Consumer"</span>,
                <span class="java&#45;quote">"load"</span>: 0,
                <span class="java&#45;quote">"name"</span>: <span class="java&#45;quote">"Connection2Consumer"</span>,
                <span class="java&#45;quote">"numConfigured"</span>: 1,
                <span class="java&#45;quote">"numConsuming"</span>: 1,
                <span class="java&#45;quote">"numProcessing"</span>: 0,
                <span class="java&#45;quote">"queue"</span>: <span class="java&#45;quote">"connection2&#45;queue"</span>,
                <span class="java&#45;quote">"runningState"</span>: <span class="java&#45;quote">"RUNNING"</span>
            &#125;
        &#93;,
        <span class="java&#45;quote">"host"</span>: <span class="java&#45;quote">"localhost"</span>,
        <span class="java&#45;quote">"name"</span>: <span class="java&#45;quote">"connection2"</span>,
        <span class="java&#45;quote">"port"</span>: 5672,
        <span class="java&#45;quote">"runningState"</span>: <span class="java&#45;quote">"RUNNING"</span>,
        <span class="java&#45;quote">"virtualHost"</span>: <span class="java&#45;quote">"test2.rabbitmq.budjb.com"</span>
    &#125;
&#93;</pre></div>


<h2 id="transactions">7.3 Transactions</h2>
The plugin provides a bit of automation around channel transactions. When a consumer is defined with the <code>transacted</code> property set to <code>true</code>, a transaction is automatically started on
the channel passed to the message handler. When the message handler completes successfully, the transaction is automatically committed. If an unhandled exception is thrown from the message
handler, the transaction is automatically rolled back.<p class="paragraph"/>It is <strong class="bold">especially important</strong> that any messages published from a message handler use the <code>Channel</code> instance passed in the <code>MessageContext</code> for this functionality to work.<p class="paragraph"/>Since the <code>Channel</code> is passed in the <code>MessageContext</code>, the author has full control over committing and rolling back transactions.



<h1 id="upgrading">8 Upgrading</h1>
When an update to the plugin is made that has incompatibility considerations, this document will help identify the
various impact considerations when upgrading to a new version.



<h2 id="from_3_0_x">8.1 From 3.0.X</h2>
The upgrade from 3.0.X to 3.1.X includes a refactor of how the consumer and connection managers work.
The storage of consumer handlers was moved from the connection classes into the consumer manager in order
to support the new start/stop functionality, and it made sense for consumer handlers to reside with
the appropriately named manager.<p class="paragraph"/>Both of the managers also now have underlying interfaces that define how a manager should behave. In addition,
the objects being managed are now called <strong class="bold">Contexts</strong>, which also have interfaces that define their general
behavior.  It is the intention that with these changes the plugin becomes more stable with less backwards-
compatibility breaking changes being introduced moving forward.<p class="paragraph"/>Here are the items authors may need to address when upgrading to this version of the plugin.
<ul class="star">
<li>The <code>rabbitContext.getConnection()</code> methods now return the RabbitMQ <code>Connection</code> object instead of&#10;  the <code>ConnectionContext</code> instance.  This was done to make the methods more consistent with the&#10;  <code>createChannel</code> methods and to encapsulate the <code>ConnectionContext</code> objects inside the manager.&#10;  The <code>ConnectionContext</code> objects can now be retrieved from the <code>consumerManager</code> bean.</li>
<li>Many of the methods inside of the <code>ConsumerManager</code> and <code>ConnectionManager</code> have been renamed to adhere&#10;  to a common interface.  This should only affect projects that use these beans directly.</li>
<li>Some of the methods inside of the <code>RabbitContext</code> have been renamed to match the interface used by&#10;  the various managers.</li>
</ul><p class="paragraph"/>Overall, users of the plugin should see no impact if the <code>rabbitContext</code> or any of the other beans are
not used in their projects.<p class="paragraph"/>If the use of the plugin's beans is limited to the <code>rabbitContext</code>, the impact should be minimal,
with some minor changes need to method names and some refactored code if retrieving a <code>ConnectionContext</code>.
Users that use the other manager beans will need to account for the changed interface implemented by
those beans.


<h2 id="from_2_0_x">8.2 From 2.0.X</h2>
The upgrade from any version in the 2.0.X range to 3.0.X includes a massive refactoring of the internals of the plugin.  If users did not extend or override
the <code>RabbitContext</code>, <code>RabbitMessageBuilder</code>, or any of the other helper classes, the amount of impact is limited to a couple package name changes.<p class="paragraph"/>Below are the changes that were made, at a high level:
<ul class="star">
<li><code>RabbitMessageBuilder</code> is deprecated.  The class still exists and its interface is the same, however, the code in the class has been ripped out and now proxies requests to the <code>rabbitMessagePublisher</code> bean.  The builder will be removed at some point in the near future.</li>
<li><code>RabbitContext</code> used to contain a significant amount of code related to management of message converters, consumers, and connections.  That functionality has been broken out into their own respective classes.  The <code>RabbitContext</code> now serves only as a class to aggregate functionality useful to users of the plugin, and should still be used to simplify interfacing with the plugin rather than using the underlying beans directly.</li>
<li>Introduced the <code>rabbitMessagePublisher</code> as a replacement for the <code>RabbitMessageBuilder</code>.  This bean can be injected into other spring managed beans, such as services, controllers, and rabbit consumers.  Its functionality follows the builder closely, and users may send messages based on configurations made through closures or through the new <code>RabbitMessageProperties</code> object.  The short-hand convenience methods are still available as well.</li>
<li>Introduced the <code>messageConverterManager</code> bean to handle all operations pertaining to message converters.</li>
<li>Introduced the <code>consumerManager</code> bean to handle all operations pertaining to message consumers.</li>
<li>Introduced the <code>connectionManager</code> bean to handle all operations pertaining to RabbitMQ connections and channels.</li>
<li>Introduced the <code>queueBuilder</code> bean to handle creating configured exchanges and queues.</li>
<li>The <code>MessageContext</code> class has been moved into a new package: <code>com.budjb.rabbitmq.consumer</code>.</li>
<li>The <code>AutoAck</code> enum has been moved into a new package: <code>com.budjb.rabbitmq.consumer</code>.</li>
<li>The <code>ConsumerConfiguration</code> class has been moved into a new package: <code>com.budjb.rabbitmq.consumer</code>.</li>
<li>The <code>MessageConvertMethod</code> class has been moved into a new package: <code>com.budjb.rabbitmq.consumer</code>.</li>
<li>The <code>ConnectionContext</code> class has been moved into a new package: <code>com.budjb.rabbitmq.connection</code>.</li>
<li>The <code>ConnectionConfiguration</code> class has been moved into a new package: <code>com.budjb.rabbitmq.connection</code>.</li>
<li>The <code>MessageConverter</code> abstract class has been moved into a new package: <code>com.budjb.rabbitmq.converter</code>.</li>
<li>All of the bundles message converters have been moved into a new package: <code>com.budjb.rabbitmq.converter</code>.</li>
<li>The <code>RabbitMessageBuilder</code> class has been moved into a new package: <code>com.budjb.rabbitmq.publisher</code>.</li>
<li>A large amount of unit tests and some integration tests have been added to the project.  These tests rely on the Spock mocking framework, but the test files and dependencies are not exported with the plugin so that a new plugin dependency on Spock is not created.</li>
<li>The closures used for publishing messages have had their resolving strategy changed from <code>OWNER_FIRST</code> to <code>DELEGATE_FIRST</code>. This should not have much of an impact, but in some cases closures may need to explicity qualify some properties in the closures with <code>delegate</code>.</li>
</ul><p class="paragraph"/>


<h1 id="changelog">9 Changelog</h1>
<h3>Version 3.1.3 - 4/20/2016</h3>
<ul class="star">
<li>Add status reports that provides information about all connections and their consumers, including load statistics.</li>
<li>Upgrade project to Grails 2.5.4.</li>
<li>Remove gpars dependency.</li>
<li>Make Grails 2.3 the minimum version of Grails this plugin is intended for.</li>
<li>Fix consumer configuration from application config parsing issue (#73).</li>
<li>Refactor message conversion for incoming messages so that conversion to a type only happens if an appropriate handler exists.</li>
</ul><p class="paragraph"/><h3>Version 3.1.2 - 8/6/2015</h3>
<ul class="star">
<li>Added graceful shutdown support. See <code>rabbitContext.shutdown()</code>.</li>
<li>Added methods to check running state on most managers and contexts.</li>
<li>Updated rabbitmq Java library to 3.5.4.</li>
<li>Added the <code>gpars</code> plugin as a dependency.</li>
</ul><p class="paragraph"/><h3>Version 3.1.1 - 5/13/2015</h3>
<ul class="star">
<li>Refactored the code to load a consumer's configuration from a static variable so that it works correctly when the&#10;  consumer is annotated with <code>&#64;Transactional</code>.&#10;  (<a href="http://github.com/budjb/grails-rabbitmq-native/issues/55" target="blank">#55</a>)</li>
<li>Add setter methods for the message TTL (<code>expiration</code>).&#10;  (<a href="http://github.com/budjb/grails-rabbitmq-native/issues/56" target="blank">#56</a>)</li>
<li>Fix bug where missing connection configuration values do not allow the use of default values.</li>
<li>Remove checked exception from ConsumerManageImpl that does not exist in its interface.&#10;  (<a href="http://github.com/budjb/grails-rabbitmq-native/issues/59" target="blank">#59</a>)</li>
</ul><p class="paragraph"/><h3>Version 3.1.0 - 3/13/2015</h3>
<ul class="star">
<li>Update the RabbitMQ Client Java library to 3.5.0.</li>
<li>Fix an issue that caused unclean shutdowns when redeploying an application using the plugin.&#10;  (<a href="http://github.com/budjb/grails-rabbitmq-native/issues/54" target="blank">#54</a>)</li>
<li>Added the ability to start and stop individual connections.&#10;  (<a href="http://github.com/budjb/grails-rabbitmq-native/issues/49" target="blank">#49</a>)</li>
<li>Added the ability to start and stop individual consumers.&#10;  (<a href="http://github.com/budjb/grails-rabbitmq-native/issues/49" target="blank">#49</a>)</li>
<li>Added the ability to start and stop consumers based on the connection they're tied to.&#10;  (<a href="http://github.com/budjb/grails-rabbitmq-native/issues/49" target="blank">#49</a>)</li>
<li>Moved consumer adapter storage from the connection context to the consumer manager.</li>
<li>Handle <code>Throwable</code> types that were not being handled before in the consumer handling so that channels are not closed&#10;  if one of the unhandled errors occurs.&#10;  (<a href="http://github.com/budjb/grails-rabbitmq-native/issues/47" target="blank">#47</a>)</li>
<li>Added travis-ci continuous integration for all commits to the plugin.</li>
</ul><p class="paragraph"/><h3>Version 3.0.4 - 2/18/2015</h3>
<ul class="star">
<li>Fix a null pointer exception when a consumer has no configuration.</li>
<li>Add a unit test to test behavior when a consumer has no configuration.</li>
<li>Add an integration test to test behavior when sending a message directly to a queue.</li>
</ul><p class="paragraph"/><h3>Version 3.0.3 - 2/15/2015</h3>
<ul class="star">
<li>Introduced the <code>rabbitMessagePublisher</code> bean to replace the <code>RabbitMessageBuilder</code>.</li>
<li>Deprecated the <code>RabbitMessageBuilder</code>.</li>
<li>Massive refactor of the internals of the plugin.  See the upgrading page for more detailed information about what has&#10;  changed.</li>
<li>Added the ability to configure consumers centrally in the application's configuration file (thanks Erwan Arzur).</li>
<li>Updated RabbitMQ library version to 3.4.3.</li>
</ul><p class="paragraph"/><h3>Version 3.0.2</h3>
<ul class="star">
<li>Internal release, see 3.0.3.</li>
</ul><p class="paragraph"/><h3>Version 3.0.1</h3>
<ul class="star">
<li>Internal release, see 3.0.3.</li>
</ul><p class="paragraph"/><h3>Version 3.0.0</h3>
<ul class="star">
<li>Internal Release, see 3.0.3.</li>
</ul><p class="paragraph"/><h3>Version 2.0.10 - 9/11/2014</h3>
<ul class="star">
<li>Fix bug with converters that prevented converters later in the processing list from executing if another convert is&#10;  unable to marshall data from bytes.</li>
<li>Add <code>enabled</code> flag to the configuration. If false, completely disables the plugin from starting.</li>
</ul><p class="paragraph"/><h3>Version 2.0.9 - 9/9/2014</h3>
<ul class="star">
<li>Additional fix for memory leak associated with RPC calls and auto-recovering connections.</li>
</ul><p class="paragraph"/><h3>Version 2.0.8 - 9/8/2014</h3>
<ul class="star">
<li>Fix bug introduced by rushing the previous fix. Mark consuming = true.</li>
</ul><p class="paragraph"/><h3>Version 2.0.7 - 9/8/2014</h3>
<ul class="star">
<li>Add <code>basicCancel()</code> to <code>RabbitMessageBuilder</code> in an attempt to address a memory leak.</li>
<li>Improve cleaning up of resources in RPC calls.</li>
</ul><p class="paragraph"/><h3>Version 2.0.6 - 8/13/2014</h3>
<ul class="star">
<li>Updated copyright notices.</li>
<li>Added GString message converter.</li>
<li>Updated publishing guide docs to make RabbitMessageBuilder usage more clear (thanks marcDeSantis @GitHub).</li>
</ul><p class="paragraph"/><h3>Version 2.0.5 - 8/01/2014</h3>
<ul class="star">
<li>Added heartbeat configuration for connections (thanks LuisMuniz @GitHub).</li>
<li>Refactored Hibernate session support so that Hibernate is no longer a dependency of the plugin, and will now work&#10;  with or without Hibernate present.</li>
</ul><p class="paragraph"/><h3>Version 2.0.4 - 7/28/2014</h3>
<ul class="star">
<li>Added multi-server support to all aspects of the plugin.</li>
<li>Added SSL support for connections.</li>
<li>Added auto-reconnect support for dropped connections.</li>
<li>Added logic to wrap a Hibernate session around calls to consumers.</li>
<li>Updated the RabbitMQ library to version 3.3.0.</li>
<li>Added logging for connection/channel reconnects and channel shutdowns.</li>
<li>Changed format for connection configurations. The old style is still supported, but will likely be removed at some&#10;  point.</li>
</ul><p class="paragraph"/><h3>Version 1.0.3 - 1/7/2014</h3>
<ul class="star">
<li>Modified the logic to check for the existence of callbacks in consumers.</li>
</ul><p class="paragraph"/><h3>Version 1.0.2 - 1/6/2014</h3>
<ul class="star">
<li>Added a cached thread pool so the user does not need to account for the number of threads consumers require. Set the&#10;  default to 0 so that this is the default.</li>
<li>Added callbacks for messages: onReceive, onSuccess, onFailure, and onComplete.</li>
</ul><p class="paragraph"/><h3>Version 1.0.1 - 11/28/2013</h3>
<ul class="star">
<li>Remove the maven group from the plugin definition class.</li>
</ul><p class="paragraph"/><h3>Version 1.0.0 - 11/27/2013</h3>
<ul class="star">
<li>Version bump for general release.</li>
</ul><p class="paragraph"/><h3>Version 0.2.1 - 11/27/2013</h3>
<ul class="star">
<li>Fixed a bug with the message handler discovery method that caused generically-typed handlers to get called&#10;  incorrectly.</li>
</ul><p class="paragraph"/><h3>Version 0.2.0 - 11/27/2013</h3>
<ul class="star">
<li>Refactored queue/exchange configuration. It is now possible configure queue binding without having to also configure&#10;  the exchange being bound to.</li>
<li>Added the <code>match</code> property to queue configuration to support headers exchange binding.&#10;  <strong class="bold">This breaks backwards compatibility.</strong></li>
<li>Renaming the <code>routingKey</code> property of the consumer configuration to <code>binding</code> to match queue configuration.&#10;  <strong class="bold">This breaks backwards compatibility.</strong></li>
</ul><p class="paragraph"/><h3>Version 0.1.8 - 10/31/2013</h3>
<ul class="star">
<li>Moved the trigger to start consumers on application launch to the bootstrap.</li>
</ul><p class="paragraph"/><h3>Version 0.1.7 - 10/30/2013</h3>
<ul class="star">
<li>Added the <code>prefetchCount</code> option to the consumer configuration. Defaults to 1.</li>
<li>Added the <code>threads</code> option to the connection configuration. Defaults to 5.</li>
</ul><p class="paragraph"/><h3>Version 0.1.6 - 10/29/2013</h3>
<ul class="star">
<li>Fixed logic to determine if a consumer is valid.</li>
<li>Added support for short-form handlers that only take a single parameter.</li>
</ul><p class="paragraph"/><h3>Version 0.1.5 - 10/28/2013</h3>
<ul class="star">
<li><code>body</code> parameter to the <code>RabbitMessageBuilder</code> is no longer required. It now defaults to an empty byte array.</li>
</ul><p class="paragraph"/><h3>Version 0.1.4 - 10/28/2013</h3>
<ul class="star">
<li>Fix a class visibility issue in the artefact handlers for this plugin.</li>
</ul><p class="paragraph"/><h3>Version 0.1.3 - 10/23/2013</h3>
<ul class="star">
<li>Touch up the consumer template.</li>
</ul><p class="paragraph"/><h3>Version 0.1.2 - 10/22/2013</h3>
<ul class="star">
<li>Add the ability to create multiple consumers at the same time with the <code>create-consumer</code> script (thanks Aaron Brown!).</li>
<li>Also create a unit test when creating consumers (thanks Michael Rice!).</li>
</ul><p class="paragraph"/><h3>Version 0.1.1 - 10/22/2013</h3>
<ul class="star">
<li>Throw an exception if the connection configuration is missing on application start (thanks Michael Rice!).</li>
<li>Add the <code>create-consumer</code> script (thanks Aaron Brown!).</li>
</ul><p class="paragraph"/><h3>Version 0.1 - 10/17/2013</h3>
<ul class="star">
<li>Code complete/experimental release.</li>
</ul><p class="paragraph"/>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Command Line</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-consumer.html">create-consumer</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Connection Configuration</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/automaticReconnect.html">automaticReconnect</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/host.html">host</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/isDefault.html">isDefault</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/name.html">name</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/password.html">password</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/port.html">port</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/requestedHeartbeat.html">requestedHeartbeat</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/ssl.html">ssl</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/threads.html">threads</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/username.html">username</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Connection%20Configuration/virtualHost.html">virtualHost</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Consumer Configuration</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/autoAck.html">autoAck</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/binding.html">binding</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/connection.html">connection</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/consumers.html">consumers</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/convert.html">convert</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/exchange.html">exchange</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/match.html">match</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/prefetchCount.html">prefetchCount</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/queue.html">queue</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/retry.html">retry</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Consumer%20Configuration/transacted.html">transacted</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Rabbit Message Publisher</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/appId.html">appId</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/autoConvert.html">autoConvert</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/body.html">body</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/connection.html">connection</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/contentEncoding.html">contentEncoding</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/contentType.html">contentType</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/correlationId.html">correlationId</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/deliveryMode.html">deliveryMode</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/exchange.html">exchange</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/expiration.html">expiration</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/header.html">header</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/messageId.html">messageId</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/priority.html">priority</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/replyTo.html">replyTo</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/routingKey.html">routingKey</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/timeout.html">timeout</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/timestamp.html">timestamp</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/type.html">type</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Rabbit%20Message%20Publisher/userId.html">userId</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
